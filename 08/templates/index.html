<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <title>Projects</title>
  </head>
  <body>
    <h1>Projects</h1>
    <hr>
    <a class="btn btn-dark" href="{{ url_for('projects_add') }}">Add project</a>
    <hr>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Title</th>
          <th scope="col">Description</th>
          <th scope="col">Status</th>
          <th scope="col">Created at</th>
          <th scope="col">Options</th>
        </tr>
      </thead>
      <tbody id="projects">
        {% for item in items %}
        <tr id="project-{{ item.id }}" {% if item.status == "new" %}class="table-success"{% endif %}  {% if item.status == "pending" %}class="table-warning"{% endif %}  {% if item.status == "closed" %}class="table-danger"{% endif %}>
          <th scope="row">{{ item.id }}</th>
          <td>{{ item.title }}</td>
          <td>{{ item.description }}</td>
          <td>{{ item.status }}</td>
          <td>{{ item.created_at.strftime("%Y-%m-%d %H:%M:%S") }}</td>
          <td>
            <a href="{{ url_for('projects_edit_by_id', id=item.id) }}" class="btn btn-info">Edit</a>
            <a href="{{ url_for('projects_delete_by_id', id=item.id) }}" class="btn btn-danger">Delete</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js" integrity="sha384-mkQ3/7FUtcGyoppY6bz/PORYoGqOl7/aSUMn2ymDOJcapfS6PHqxhRTMh1RR0Q6+" crossorigin="anonymous"></script>
    <script>
        let socket = io();
        socket.on("connect", function() {
            socket.emit("ws-welcome", {data: "Connected ...."});
        })
        socket.on("ws-projects-add", function(item) {
            let td_class = "";
            if (item.status == "new") {
              td_class = "table-success"
            }
            if (item.status == "pending") {
              td_class = "table-warning"
            }
            if (item.status == "closed") {
              td_class = "table-danger"
            }
            $("#projects").append("<tr id='project-" + item.id + "' class='" + td_class + "'><th scope='row'>" + item.id + "</th><td>" + item.title + "</td><td>" + item.description + "</td><td>" + item.status + "</td><td>" + item.created_at + "</td><td><a href='/projects/" + item.id + "/edit/' class='btn btn-info'>Edit</a><a href='/projects/" + item.id + "/delete/' class='btn btn-danger'>Delete</a></td></tr>");
        })
        socket.on("ws-projects-edit", function(item) {
          let td_class = "";
            if (item.status == "new") {
              td_class = "table-success"
            }
            if (item.status == "pending") {
              td_class = "table-warning"
            }
            if (item.status == "closed") {
              td_class = "table-danger"
            }
            $("#project-" + item.id).html("<th scope='row'>" + item.id + "</th><td>" + item.title + "</td><td>" + item.description + "</td><td>" + item.status + "</td><td>" + item.created_at + "</td><td><a href='/projects/" + item.id + "/edit/' class='btn btn-info'>Edit</a><a href='/projects/" + item.id + "/delete/' class='btn btn-danger'>Delete</a></td>");
            $("#project-" + item.id).removeClass('table-success').removeClass('table-warning').removeClass('table-danger').addClass(td_class);
        })
        socket.on("ws-projects-delete", function(item) {
            $("#project-" + item.id).remove();
        })
</script>
</body>
</html>